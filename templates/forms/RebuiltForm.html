{% extends "scout.html" %}
{% block form %}

<link rel="stylesheet" type="text/css" href="static/rebuilt_style.css">

<div class="container-fluid px-2 rebuiltShell">
  <div class="rebuiltGrid">

    <!-- AUTO (left aligned to keep current stp) -->
    <div class="rebuiltCol">
      <table class="tbl rebuiltCard">
        <thead>
          <tr>
            <th class="a color-fade rebuiltHeader" colspan="3">AUTO</th>
          </tr>
        </thead>
        <tbody>
          <tr id="mobilityTr">
            <td></td>
            <th>Mobility</th>
            <td>{{ form.autoMobility(class="inp check") }}</td>
          </tr>

          <tr>
            <th>Shots</th>
            <th>Attempted</th>
            <td>
              <div class="stepper" data-target="autoShots">
                <button type="button" class="stepBtn stepBtn--neg" data-delta="-1" aria-label="Auto shots minus one">-</button>
                {{ form.autoShots(class="inp stepInput", inputmode="numeric", pattern="[0-9]*") }}
                <div class="stepBtnGroup" role="group" aria-label="Auto shots increment">
                  <button type="button" class="stepBtn stepBtn--pos" data-delta="1">+1</button>
                  <button type="button" class="stepBtn stepBtn--pos" data-delta="5">+5</button>
                  <button type="button" class="stepBtn stepBtn--pos" data-delta="10">+10</button>
                </div>
              </div>
            </td>
          </tr>

          <tr>
            <th></th>
            <th>Accuracy</th>
            <td>
              <div class="sliderRow">
                <input type="range" min="0" max="100" class="slider" id="autoAccuracySlider" aria-label="Auto shot accuracy">
                {{ form.autoShotAccuracy(class="inp hidden") }}
                <span id="autoAccuracyValue" class="pct">0%</span>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- TELEOP (cnter aligned)-->
    <div class="rebuiltCol rebuiltColTele">
      <table class="tbl rebuiltCard">
        <thead>
          <tr>
            <th class="a color-fade rebuiltHeader" colspan="3">TELEOP</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th>Shots</th>
            <th>Attempted</th>
            <td>
              <div class="stepper" data-target="teleopShots">
                <button type="button" class="stepBtn stepBtn--neg" data-delta="-1" aria-label="Teleop shots minus one">-</button>
                {{ form.teleopShots(class="inp stepInput", inputmode="numeric", pattern="[0-9]*") }}
                <div class="stepBtnGroup" role="group" aria-label="Teleop shots increment">
                  <button type="button" class="stepBtn stepBtn--pos" data-delta="1">+1</button>
                  <button type="button" class="stepBtn stepBtn--pos" data-delta="5">+5</button>
                  <button type="button" class="stepBtn stepBtn--pos" data-delta="10">+10</button>
                </div>
              </div>
            </td>
          </tr>

          <tr>
            <th></th>
            <th>Accuracy</th>
            <td>
              <div class="sliderRow">
                <input type="range" min="0" max="100" class="slider" id="teleopAccuracySlider" aria-label="Teleop shot accuracy">
                {{ form.teleopShotAccuracy(class="inp hidden") }}
                <span id="teleopAccuracyValue" class="pct">0%</span>
              </div>
            </td>
          </tr>

          <tr id="passTr">
            <th colspan="2">Passed?</th>
            <td>{{ form.teleopPassed(class="inp check") }}</td>
          </tr>

          <tr id="defenseTr">
            <th colspan="2">Played Defense</th>
            <td>{{ form.teleopDefense(class="inp check") }}</td>
          </tr>

          <!--  HeatMap (changed to have multiple scoring locations tracked, "bootstrap" (its not actually bootstrap lol) to ensure the image isnt too big) -->
          <tr>
            <th colspan="3">Scoring Locations</th>
          </tr>
          <tr>
            <td colspan="3" class="pad10">
              <div class="fieldMapCard">
                <div class="fieldMapTop">
                  <div class="fieldMapTopLeft">
                    <span class="fieldMapHint">Tap/click each scoring position (10+ clicks supported).</span>
                    <div class="fieldMapMeta">
                      <span class="fieldMapPill">Count: <span id="fieldMapCount">0</span></span>
                      <span class="fieldMapPill">Last: <span id="fieldMapLast">none</span></span>
                    </div>
                  </div>
                  <div class="fieldMapActions" role="group" aria-label="Field map actions"> <!-- ensure all fields have a delete/undo-->
                    <button type="button" id="fieldUndoBtn" class="miniBtn" title="Undo last click">Undo</button> 
                    <button type="button" id="fieldClearBtn" class="miniBtn miniBtn--danger" title="Clear all clicks">Clear</button> <!-- slightly buggy rn, but allows for complete clearing of the map-->
                  </div>
                </div>

                <div class="fieldMapWrap" aria-label="Field map">
                  <img
                    id="rebuiltFieldImg"
                    class="fieldMapImg"
                    src="{{ url_for('static', filename='2026-field.png') }}"
                    alt="2026 REBUILT field map">
                  <div id="fieldMapOverlay" class="fieldMapOverlay" aria-hidden="true"></div>
                </div>

                <!-- stored as CSV, scoring loctions are based on the x,y coords-->
                {{ form.teleopScoreLocation(class="inp hidden") }}
                <div class="fieldMapNote">
                  <span class="muted">Clicks outside the trench scoring bands (including center/neutral) are ignored.</span> <!-- error catching, no scouts should be clicking in the netural zone-->
                </div>
              </div>
            </td>
          </tr>
<!-- probably need to figure out a better way to stop scouters from clicking red zonze when scouting blue etc.-->
          <tr>
            <th colspan="2">Who was defended?</th>
            <td>{{ form.defenseExperienced(class="inp wide")}}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- 3rd col with endgame, fouls etc. no tower map yet-->
    <div class="rebuiltCol rebuiltColRight">

      <!-- ENDGAME -->
      <table class="tbl rebuiltCard">
        <thead>
          <tr>
            <th class="a color-fade rebuiltHeader" colspan="3">ENDGAME</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th colspan="3">Climb Location</th>
          </tr>
          <tr>
            <td colspan="3" class="pad10">
              <div class="climbGrid">
                <button type="button" class="climbGridBtn" data-level="none" data-position="1">1</button>
                <button type="button" class="climbGridBtn" data-level="none" data-position="2">2</button>
                <button type="button" class="climbGridBtn" data-level="none" data-position="3">3</button>
                <button type="button" class="climbGridBtn" data-level="level1" data-position="4">L1</button>
                <button type="button" class="climbGridBtn" data-level="level1" data-position="5">L1</button>
                <button type="button" class="climbGridBtn" data-level="level1" data-position="6">L1</button>
                <button type="button" class="climbGridBtn" data-level="level2" data-position="7">L2</button>
                <button type="button" class="climbGridBtn" data-level="level2" data-position="8">L2</button>
                <button type="button" class="climbGridBtn" data-level="level3" data-position="9">L3</button>
              </div>
              {{ form.climb(class="inp hidden") }}
            </td>
          </tr>

          <tr>
            <th colspan="3">Climb Timer</th>
          </tr>
          <tr>
            <td colspan="3" class="pad10 center">
              <button type="button" id="climbStartBtn" class="timerBtn">Start Timer</button>
              <span id="climbTimer" class="timerReadout">0.0s</span>
              <label class="inlineCheck">
                {{ form.climbFailed(class="inp check") }}
                Failed
              </label>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- phouls -->
      <table class="tbl rebuiltCard">
        <thead>
          <tr>
            <th class="a color-fade rebuiltHeader" colspan="2">ERRORS</th>
          </tr>
        </thead>
        <tbody>
          <tr id="foulTr">
            <th>Fouls</th>
            <td>
              <!-- do NOT use .addButton/.subtractButton, will double count for some reason -->
              <div class="miniStepper" data-target="fouls">
                <button type="button" class="miniStepBtn miniStepBtn--neg" data-delta="-1" aria-label="Fouls minus one">-</button>
                {{ form.fouls(class="inp miniStepInput", inputmode="numeric", pattern="[0-9]*") }}
                <button type="button" class="miniStepBtn miniStepBtn--pos" data-delta="1" aria-label="Fouls plus one">+</button>
              </div>
            </td>
          </tr>

          <tr id="brokenTr">
            <th>Failure</th>
            <td>{{ form.failure(class="inp check") }}</td>
          </tr>
        </tbody>
      </table>

      <!-- can make this below, just tried to compact it all into one screen, looks bad rn.... -->
      <table class="tbl rebuiltCard">
        <thead>
          <tr>
            <th class="a color-fade rebuiltHeader" colspan="1">COMMENTS</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="pad10">
              {{ form.info(class="info compactInfo", placeholder="Notes: fouls, breakdowns, defense quality, driver skill, etc.") }}
              <div class="muted" style="margin-top:6px; font-size:12px;">
                Tip: keep this short during match; expand later if needed.
              </div>
            </td>
          </tr>
        </tbody>
      </table>

    </div>

  </div>
</div>


<script src="static/rebuilt_script.js"></script>

{% endblock %}
